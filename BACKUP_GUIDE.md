â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘            è¨­å®šè‡ªå‹•å‚™ä»½ - å¿«é€ŸæŒ‡å—                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ“¦ å·²ç‚ºä½ æº–å‚™å¥½å‚™ä»½è…³æœ¬

å‚™ä»½è…³æœ¬ä½ç½®: /var/www/ncu-accommodation-portal/backup-db.sh

åŠŸèƒ½:
  âœ… è‡ªå‹•å‚™ä»½è³‡æ–™åº«
  âœ… å£“ç¸®å‚™ä»½æª”æ¡ˆ (ç¯€çœç©ºé–“)
  âœ… æª¢æŸ¥è³‡æ–™åº«å®Œæ•´æ€§
  âœ… è‡ªå‹•æ¸…ç† 30 å¤©å‰çš„èˆŠå‚™ä»½
  âœ… è¨˜éŒ„å‚™ä»½æ—¥èªŒ

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸš€ æ–¹å¼ä¸€ï¼šæ‰‹å‹•å‚™ä»½ (æœ€ç°¡å–®)

ç•¶ä½ æƒ³è¦å‚™ä»½æ™‚ï¼Œç›´æ¥åŸ·è¡Œï¼š

```bash
cd /var/www/ncu-accommodation-portal
./backup-db.sh
```

å‚™ä»½æª”æ¡ˆæœƒå„²å­˜åœ¨: /var/www/ncu-accommodation-portal/backups/

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## â° æ–¹å¼äºŒï¼šè‡ªå‹•å®šæœŸå‚™ä»½ (æ¨è–¦)

### æ­¥é©Ÿ 1: ç·¨è¼¯ crontab

```bash
crontab -e
```

### æ­¥é©Ÿ 2: æ·»åŠ ä»¥ä¸‹ä»»ä¸€è¡Œ (é¸æ“‡ä¸€å€‹)

```bash
# é¸é … A: æ¯å¤©å‡Œæ™¨ 2 é»è‡ªå‹•å‚™ä»½ (æ¨è–¦)
0 2 * * * /var/www/ncu-accommodation-portal/backup-db.sh >> /var/log/ncu-backup.log 2>&1

# é¸é … B: æ¯å¤©ä¸­åˆ 12 é»è‡ªå‹•å‚™ä»½
0 12 * * * /var/www/ncu-accommodation-portal/backup-db.sh >> /var/log/ncu-backup.log 2>&1

# é¸é … C: æ¯ 6 å°æ™‚å‚™ä»½ä¸€æ¬¡
0 */6 * * * /var/www/ncu-accommodation-portal/backup-db.sh >> /var/log/ncu-backup.log 2>&1

# é¸é … D: æ¯é€±æ—¥å‡Œæ™¨ 3 é»å‚™ä»½
0 3 * * 0 /var/www/ncu-accommodation-portal/backup-db.sh >> /var/log/ncu-backup.log 2>&1
```

### æ­¥é©Ÿ 3: å„²å­˜ä¸¦é€€å‡º

- åœ¨ nano ç·¨è¼¯å™¨ä¸­: æŒ‰ `Ctrl+X`ï¼Œç„¶å¾Œ `Y`ï¼Œå†æŒ‰ `Enter`
- åœ¨ vim ç·¨è¼¯å™¨ä¸­: æŒ‰ `ESC`ï¼Œè¼¸å…¥ `:wq`ï¼ŒæŒ‰ `Enter`

### æ­¥é©Ÿ 4: é©—è­‰ cron ä»»å‹™å·²è¨­å®š

```bash
crontab -l
```

æ‡‰è©²æœƒçœ‹åˆ°ä½ å‰›å‰›æ·»åŠ çš„é‚£ä¸€è¡Œã€‚

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ“… Cron æ™‚é–“æ ¼å¼èªªæ˜

```
* * * * * æŒ‡ä»¤
â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€ æ˜ŸæœŸ (0-7, 0å’Œ7éƒ½ä»£è¡¨æ˜ŸæœŸæ—¥)
â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€ æœˆä»½ (1-12)
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€ æ—¥æœŸ (1-31)
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ å°æ™‚ (0-23)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ†é˜ (0-59)
```

### å¸¸ç”¨ç¯„ä¾‹ï¼š

```bash
0 2 * * *       # æ¯å¤©å‡Œæ™¨ 2:00
0 */6 * * *     # æ¯ 6 å°æ™‚ (0:00, 6:00, 12:00, 18:00)
0 0 * * 0       # æ¯é€±æ—¥åˆå¤œ 12:00
0 3 1 * *       # æ¯æœˆ 1 è™Ÿå‡Œæ™¨ 3:00
*/30 * * * *    # æ¯ 30 åˆ†é˜
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ” æŸ¥çœ‹å‚™ä»½çµæœ

### æŸ¥çœ‹æ‰€æœ‰å‚™ä»½ï¼š

```bash
ls -lh /var/www/ncu-accommodation-portal/backups/
```

### æŸ¥çœ‹å‚™ä»½æ—¥èªŒï¼š

```bash
cat /var/www/ncu-accommodation-portal/backups/backup.log
```

### æŸ¥çœ‹æœ€è¿‘çš„å‚™ä»½ï¼š

```bash
ls -lht /var/www/ncu-accommodation-portal/backups/ | head -n 10
```

### æŸ¥çœ‹å‚™ä»½ç¸½å¤§å°ï¼š

```bash
du -sh /var/www/ncu-accommodation-portal/backups/
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ”„ æ¢å¾©è³‡æ–™åº« (è¬ä¸€éœ€è¦)

### æ­¥é©Ÿ 1: åœæ­¢å¾Œç«¯æœå‹™

```bash
sudo systemctl stop ncu-accommodation-backend.service
```

### æ­¥é©Ÿ 2: å‚™ä»½ç•¶å‰è³‡æ–™åº« (å®‰å…¨èµ·è¦‹)

```bash
cp /var/www/ncu-accommodation-portal/backend/data.sqlite \
   /var/www/ncu-accommodation-portal/backend/data.sqlite.current
```

### æ­¥é©Ÿ 3: è§£å£“ç¸®ä¸¦æ¢å¾©å‚™ä»½

```bash
# åˆ—å‡ºæ‰€æœ‰å‚™ä»½ï¼Œé¸æ“‡è¦æ¢å¾©çš„
ls -lh /var/www/ncu-accommodation-portal/backups/

# æ¢å¾©ç‰¹å®šå‚™ä»½ (æ›¿æ›æ—¥æœŸç‚ºå¯¦éš›å‚™ä»½æª”æ¡ˆå)
gunzip -c /var/www/ncu-accommodation-portal/backups/data.sqlite.20251001_141232.gz \
  > /var/www/ncu-accommodation-portal/backend/data.sqlite
```

### æ­¥é©Ÿ 4: é‡å•Ÿå¾Œç«¯æœå‹™

```bash
sudo systemctl start ncu-accommodation-backend.service
```

### æ­¥é©Ÿ 5: é©—è­‰

```bash
# æª¢æŸ¥æœå‹™ç‹€æ…‹
sudo systemctl status ncu-accommodation-backend.service

# æª¢æŸ¥è³‡æ–™åº«å®Œæ•´æ€§
sqlite3 /var/www/ncu-accommodation-portal/backend/data.sqlite "PRAGMA integrity_check;"
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ’¡ å‚™ä»½æœ€ä½³å¯¦è¸

### âœ… å»ºè­°åšæ³•ï¼š

1. **å¤šé‡å‚™ä»½**
   - æœ¬åœ°å‚™ä»½ (å·²è¨­å®š)
   - å®šæœŸè¤‡è£½åˆ°å¤–éƒ¨å„²å­˜
   - è€ƒæ…®ä½¿ç”¨é›²ç«¯å‚™ä»½

2. **å®šæœŸæ¸¬è©¦æ¢å¾©**
   - æ¯å­£åº¦æ¸¬è©¦ä¸€æ¬¡æ¢å¾©æµç¨‹
   - ç¢ºä¿å‚™ä»½å¯ä»¥çœŸçš„ç”¨ä¾†æ¢å¾©

3. **ç›£æ§å‚™ä»½**
   - å®šæœŸæª¢æŸ¥å‚™ä»½æ˜¯å¦æˆåŠŸåŸ·è¡Œ
   - æŸ¥çœ‹å‚™ä»½æ—¥èªŒ

4. **ä¿ç•™ç­–ç•¥**
   - æ¯æ—¥å‚™ä»½: ä¿ç•™ 30 å¤©
   - æ¯é€±å‚™ä»½: ä¿ç•™ 3 å€‹æœˆ
   - æ¯æœˆå‚™ä»½: ä¿ç•™ 1 å¹´

### ğŸ“¦ é€²éš: è¤‡è£½åˆ°å¤–éƒ¨å„²å­˜

```bash
# è¤‡è£½åˆ°å¤–éƒ¨ç¡¬ç¢Ÿ (å‡è¨­æ›è¼‰åœ¨ /mnt/external)
rsync -av /var/www/ncu-accommodation-portal/backups/ /mnt/external/ncu-backups/

# è¤‡è£½åˆ°é ç«¯ä¼ºæœå™¨ (ä½¿ç”¨ scp)
scp /var/www/ncu-accommodation-portal/backups/*.gz user@remote-server:/backup/ncu/

# è¤‡è£½åˆ°å¦ä¸€å€‹ Proxmox ä¸»æ©Ÿ
rsync -av -e ssh /var/www/ncu-accommodation-portal/backups/ user@proxmox-backup:/backups/ncu/
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## âœ… å®Œæˆæª¢æŸ¥æ¸…å–®

â–¡ å‚™ä»½è…³æœ¬å·²æ¸¬è©¦é‹è¡Œ
â–¡ Cron ä»»å‹™å·²è¨­å®š (å¦‚æœé¸æ“‡è‡ªå‹•å‚™ä»½)
â–¡ å·²é©—è­‰ crontab è¨­å®š: `crontab -l`
â–¡ çŸ¥é“å¦‚ä½•æŸ¥çœ‹å‚™ä»½: `ls -lh /var/www/ncu-accommodation-portal/backups/`
â–¡ çŸ¥é“å¦‚ä½•æ¢å¾©è³‡æ–™åº«
â–¡ å·²é–±è®€ OPERATION_GUIDE.md

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æœ€å¾Œæ›´æ–°: 2025-10-01
